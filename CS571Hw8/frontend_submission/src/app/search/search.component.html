
<div class="container" style="margin-top: 50px;">
    <div class="row">
        <div class="col-md-5 offset-md-3" id="content">
            <div style="text-align: center; margin-top: 25px; margin-bottom: 25px; font-weight: 700; font-size: large;">Business Search</div>
                <form #f="ngForm" (ngSubmit)="clickMe()" ngNativeValidate>

                    <div class="row">
                        <div class="col-md-12 col-xs-12">
                            <div style="font-size:small;">KeyWord<span style="color:red;">*</span></div>
                            <!-- <input type="text" id="keyWord" style="width: 100%;" ngModel name="keyWord" #keyWord="ngModel" required> -->
                            <input type="text" matInput [matAutocomplete]="auto" [formControl]="searchKeyWordControl" id="keyWord" style="width:100%;  border: 1px solid black" required>
                            <mat-autocomplete [panelWidth]="400" #auto="matAutocomplete" (optionSelected)="onSelected()"
                                [displayWith]="displayWith">
                                <mat-option *ngIf="isLoading" class="is-loading">Loading...</mat-option>
                                <ng-container *ngIf="!isLoading">
                                    <mat-option *ngFor="let cate of autoCate" [value]="cate">
                                      <span><b>{{cate.title}}</b></span>
                                    </mat-option>
                                </ng-container>
                            </mat-autocomplete>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 col-xs-12">
                            <div style="font-size:small;">Distance<span style="color:red">*</span></div>
                            <input type="text" id="distance" style="width: 100%; border: 1px solid black" ngModel name="distance" #distance="ngModel" [(ngModel)]="dis" required>  
                        </div>     
                        <div class="col-md-6 col-xs-12">
                            <div style="font-size:small;">Category<span style="color:red">*</span></div>
                            <div> 
                                <select name="selectCategory" id="sel"  style="width: 100%;">
                                    <option value="default">Default</option>
                                    <option value="arts&entertainment">Arts & Entertainment</option>
                                    <option value="health&medical">Health & Medical</option>
                                    <option value="hotels&travel">Hotels & Travel</option>
                                    <option value="food">Food</option>
                                    <option value="professionalService">Professional Services</option>
                                </select> 
                            </div> 
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12 col-xs-12">      
                            <div style="font-size:small;">Location <span style="color:red">*</span></div>
                            <input type="text" id="location" style="width: 100%; border: 1px solid black" ngModel name="location" #location="ngModel" required>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-md-12" style="font-size:small;"><input type = "checkbox" class="checkBox" (click) ="clickCheckBox()" > Auto-detect my location </div>
                    </div>

                    <div class="row" style="margin-top: 20px; margin-bottom: 20px;">
                        <div class="col-md-6 col-6 text-right">
                            <button type="submit" style="border-radius: 5px; color : white; border:none" class="sub">Submit</button>
                        </div>
                        <div class="col-md-6 col-6">
                            <button type ="button" style="border-radius: 5px; color : white; border:none" class="clr" (click) = "clearAll()">Clear</button>
                        </div>
                    </div>
                </form>

            <!-- <div class="row">
                <div class="col-md-6 col-xs-12">
                    <div>Distance<span style="color:red">*</span></div>
                    <div><input type="text" id="distance"  style="width: 100%;"></div>  
                </div>     

                <div class="col-md-6 col-xs-12">
                    <div>Category<span style="color:red">*</span></div>
                    <div> 
                        <select name="selectCategory" id="sel"  style="width: 100%;">
                            <option value="default">Default</option>
                            <option value="arts&entertainment">Arts & Entertainment</option>
                            <option value="health&medical">Health & Medical</option>
                            <option value="hotels&travel">Hotels & Travel</option>
                            <option value="food">Food</option>
                            <option value="professionalService">Professional Services</option>
                        </select> 
                    </div>
                </div> 
            </div>

            <div class="row">
                <div class="col-md-12 col-xs-12">      
                    <div>Location <span style="color:red">*</span></div>
                    <div> <input type="text" id="location" style="width: 100%;"></div>
                </div>
            </div>

            <div class="row">
                <div class="col-12 col-md-12"><input type = "checkbox" class="checkBox"  (click) = "clickCheckBox()"> Auto-detect my location </div>
            </div> -->
        </div>
    </div>
</div>

<!-- <div class="container" style="margin-top: 50px;">
    <div class="row">
        <div class="col-md-5 offset-md-3" id="content">
            <div style="text-align: center">Business Search</div>
            
            <div class="row">
                <div class="col-md-12 col-xs-12">
                    <div>KeyWord<span style="color:red;">*</span></div>
                    <div><input type="text" id="keyWord" style="width: 100%;"></div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 col-xs-12">
                    <div>Distance<span style="color:red">*</span></div>
                    <div><input type="text" id="distance"  style="width: 100%;"></div>  
                </div>     

                <div class="col-md-6 col-xs-12">
                    <div>Category<span style="color:red">*</span></div>
                    <div> 
                        <select name="selectCategory" id="sel"  style="width: 100%;">
                            <option value="default">Default</option>
                            <option value="arts&entertainment">Arts & Entertainment</option>
                            <option value="health&medical">Health & Medical</option>
                            <option value="hotels&travel">Hotels & Travel</option>
                            <option value="food">Food</option>
                            <option value="professionalService">Professional Services</option>
                        </select> 
                    </div>
                </div> 
            </div>

            <div class="row">
                <div class="col-md-12 col-xs-12">      
                    <div>Location <span style="color:red">*</span></div>
                    <div> <input type="text" id="location" style="width: 100%;"></div>
                </div>
            </div>

            <div class="row">
                <div class="col-12 col-md-12"><input type = "checkbox" class="checkBox"  (click) = "clickCheckBox()"> Auto-detect my location </div>
            </div>

            <div class="row">
                <div class="col-6 col-md-6 text-right" (click) = "clickMe()">Submit</div>
                <div class="col-6 col-md-6">Clear</div>
            </div>
        </div>
    </div>
</div> -->

<!-- Modal -->
<!-- <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content" style="background-color:white">
        <div class="modal-header">
          <h2 class="modal-title" id="exampleModalLabel">Reservation Form</h2>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
            <form form>
                <div class="form-row">
                    <div class="col-md-12 col-xs-12">
                        <label for="email">Email</label>
                        <input type="email" class="form-control" id="email" formControlName = "userEmail" required>
                        <div *ngIf="userEmail.errors?.['required']">
                             Email must be a valid email
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="col-md-12 col-xs-12" style="margin-bottom:5px">
                        Date
                    </div>
                    <div class="col-md-12 col-xs-12">
                        <div class="input-group">
                            <input class="form-control" placeholder="yyyy-mm-dd" name="dp" [(ngModel)]="model" ngbDatepicker #d="ngbDatepicker" id="date" formControlName="userDate" required>
                            <div class="input-group-append">
                                <button class="btn btn-outline-secondary calendar" (click)="d.toggle()" type="button"></button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="col-md-12 col-xs-12" style="margin-bottom:5px">
                        Time
                    </div>
                    <div class="col-md-2 col-xs-2">    
                        <select name="selectHours" id="hour">
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                            <option value="13">13</option>
                            <option value="14">14</option>
                            <option value="15">15</option>
                            <option value="16">16</option>
                            <option value="17">17</option>
                        </select>
                    </div>
                    <div class="col-md-1 col-xs-1">
                        :
                    </div>
                    <div class="col-md-2 col-xs-2">
                        <select name="selectMinutes" id="minute">
                            <option value="00">00</option>
                            <option value="15">15</option>
                            <option value="30">30</option>
                            <option value="45">45</option>
                        </select>
                    </div>    
                </div>

                <div class="row">
                    <div class="col-md-12 col-xs-12" style="text-align:center">
                        <button class="btn btn-danger" type="submit" style="margin-bottom: 10px;" (click) = "getReservation()">Submit</button>
                    </div>
                </div>
            </form> 
        </div>    

        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="background-color:black">Close</button>
        </div>
      </div>
    </div>
</div> -->

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content" style="background-color:white">
        <div class="modal-header">
          <h2 class="modal-title" id="exampleModalLabel">Reservation Form</h2>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <!-- ************************************************ -->
        <div class="modal-body">
            <!-- fill in the body -->
            <app-reservation-form [name] = "this.detailName"></app-reservation-form>
            <!-- fill in the body -->
        </div>    
        <!-- ************************************************ -->
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="background-color:black" click="clearReserve()">Close</button>
        </div>
      </div>
    </div>
</div>



<div class="row" style="margin-top: 50px;" *ngIf="showDetail === 1 && showResult === 1">
    <div class="col-md-8 offset-md-2">
        <table class="yelpTable table-striped"  style="background-color: white; border-radius: 15px; text-align: center; text-align: center; width: 100%; height:50%" id="yelpTable">
            <thead>
                <tr style="height:50%">
                    <th style="text-align: center">#</th>
                    <th style="text-align: center">Image</th>
                    <th style="text-align: center">Business Name</th>
                    <th style="text-align: center">Rating</th>
                    <th style="text-align: center">Distance</th>
                </tr>
            </thead>
            <tbody>
                <ng-container  *ngFor="let yelpResult of data;let i=index">
                    <tr *ngIf="i<10" style="cursor: pointer;" (click) = "getBusinessDetail(yelpResult)">
                        <td style="text-align: center">{{i + 1}}</td>
                        <td style="text-align: center ;width:7%" ><img src= "{{yelpResult.image_url}}" alt="" style="width:100%; aspect-ratio: 1;"></td>
                        <td style="text-align: center">{{yelpResult.name}}</td>
                        <td style="text-align: center">{{yelpResult.rating}}</td>
                        <td style="text-align: center">{{(yelpResult.distance/1609.34).toFixed(0)}}</td>
                    </tr>
                </ng-container>
            </tbody>
        </table>  
    </div>
</div>


<div class="row" style="margin-top: 50px;" *ngIf="showDetail === 0 && showResult === 2">
    <div style="text-align:center">
        <div style="color:red" >No results avaliable</div>
    </div>
</div>


<div *ngIf="showDetail === 2" style="visibility:hidden; margin-top: 50px;">
    <div class="col-md-5 offset-md-3" id="detailCards" >
        <div class="row">
            <div style="text-align:center">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left" viewBox="0 0 16 16" style="float:left" (click)="changePage()">
                    <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
                </svg>
                <div>{{detailName}}</div>
            </div>
        </div>
        <mat-tab-group mat-align-tabs="center">
            <mat-tab label="Business details">
                <div style="background-color:white">
                    <!-- Row 1  Adress + Category -->
                    <div class="row" style="margin-top : 50px;">
                        <div class="col-md-6 col-xs-12" style="text-align:center">
                            <div>Address</div>
                            <div id="address"></div>
                        </div>
                        <div class="col-md-6 col-xs-12" style="text-align:center">
                            <div>Category</div>
                            <div id="category"></div>
                        </div>
                    </div>
                    <!-- Row 2  phone + price -->
                    <div class="row" style="margin-top: 20px">
                        <div class="col-md-6 col-xs-12" style="text-align:center">
                            <div>Phone</div>
                            <div id="phoneNumber"></div>
                        </div>
                        <div class="col-md-6 col-xs-12" style="text-align:center">
                            <div>Price range</div>
                            <div id="price">price range</div>
                        </div>                           
                    </div> 
                    <!-- Row 3  status + more help-->
                    <div class="row" style="margin-top: 20px">
                        <div class="col-md-6 col-xs-12" style="text-align:center">
                            <div>Status</div>
                            <div>{{isOpen}}</div>
                            <div id="status" *ngIf="isOpen == true" style="color:green">Open</div>
                            <div id="status" *ngIf="isOpen == false" style="color:red">Closed</div>
                        </div>
                        <div class="col-md-6 col-xs-12" style="text-align:center">
                            <div>Visit yelp for more</div>
                            <div><a href="" id="website" target="_blank">Business Link</a></div>
                        </div>    
                    </div>  
                    <!-- Row 4  -->   
                    <div style="text-align:center; margin-top: 50px;">
                        <button type="button" *ngIf="successStatus == false"  class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#exampleModal" id="reserveButton">
                            Reserve now
                        </button>
                        <button type = "button" *ngIf="successStatus == true" class="btn btn-danger">
                            cancel Reservation
                        </button>
                    </div>
                    <!-- facebook and twitter icon -->
                    <div class="row" style="text-align:center ;margin-top: 20px;">
                        <div style="display: inline-block;" (click) = "tweet()"> Share on:
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-twitter" viewBox="0 0 16 16" style="color:blue; display:inline-block">
                                <path d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z"/>
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-facebook" viewBox="0 0 16 16">
                                <path d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z"/>
                            </svg>
                        </div>
                    </div>
                    <!-- images -->
                    <div class="row" style="text-align: center;  margin-top: 20px;">
                        <ngb-carousel *ngIf="images">
                            <ng-template ngbSlide>
                              <div class="wrapper">
                                <img [src]="images[0]" alt="Random first slide" width="300px" height="300px">
                              </div>
                              <div class="carousel-caption">
                              </div>
                            </ng-template>
                            <ng-template ngbSlide>
                              <div class="wrapper">
                                <img [src]="images[1]" alt="Random second slide" width="300px" height="300px">
                              </div>
                              <div class="carousel-caption">
                              </div>
                            </ng-template>
                            <ng-template ngbSlide>
                              <div class="wrapper">
                                <img [src]="images[2]"  alt="Random third slide" width="300px" height="300px">
                              </div>
                              <div class="carousel-caption">
                              </div>
                            </ng-template>
                          </ngb-carousel>
                    </div>
                </div>
            </mat-tab>

            <mat-tab label="Map Location">
                <div class="my-google-map" style="text-align:center;">
                    <google-map [width]="null" [height]="null" [options]="mapOptions">
                        <map-marker [position]="marker.position"></map-marker>
                    </google-map>
                </div>
            </mat-tab>

            <mat-tab label="Reviews">
                <ng-container *ngFor="let review of userReviews; let i = index" style="background-color:white">
                    <div *ngIf="i < 3">
                        <div *ngIf="i % 2 == 0" class="row" style="background-color:white">
                            <div class="col-md-12 col-xs-12" style="margin-top:5px; margin-bottom:5px">{{review.user.name}}</div>
                            <div class="col-md-12 col-xs-12" style="margin-top:5px; margin-bottom:5px">Rating: {{review.rating}}/5</div>
                            <div class="col-md-12 col-xs-12" style="margin-top:5px; margin-bottom:5px">{{review.text}}</div>
                            <div class="col-md-12 col-xs-12" style="margin-top:5px; margin-bottom:5px">{{review.time_created}}</div>                            
                        </div>

                        <div *ngIf="i % 2 != 0"class="row" style="background-color:gray">
                            <div class="col-md-12 col-xs-12" style="margin-top:5px; margin-bottom:5px">{{review.user.name}}</div>
                            <div class="col-md-12 col-xs-12" style="margin-top:5px; margin-bottom:5px">Rating: {{review.rating}}/5</div>
                            <div class="col-md-12 col-xs-12" style="margin-top:5px; margin-bottom:5px">{{review.text}}</div>
                            <div class="col-md-12 col-xs-12" style="margin-top:5px; margin-bottom:5px">{{review.time_created}}</div>                            
                        </div>
                        <!-- <div class="row" style="background-color: gray">
                            <div class="col-md-12 col-xs-12">{{review.id}}</div>
                            <div class="col-md-12 col-xs-12">{{review_rate_2}}</div>
                            <div class="col-md-12 col-xs-12">{{review_comment_2}}</div>
                            <div class="col-md-12 col-xs-12">{{review_date_2}}</div>                               
                        </div>
                        <div class="row" style="background-color:white">
                            <div class="col-md-12 col-xs-12">{{review.id}}</div>
                            <div class="col-md-12 col-xs-12">{{review_rate_3}}</div>
                            <div class="col-md-12 col-xs-12">{{review_comment_3}}</div>
                            <div class="col-md-12 col-xs-12">{{review_date_3}}</div>                               
                        </div> -->
                    </div>
                </ng-container>
            </mat-tab>
        </mat-tab-group>
    </div>
</div>

<!-- <div class="container" style="margin-top: 50px">
    <div class="col-md-5 offset-md-3" id="content" style="background-color:white">
        <div style="text-align: center">Business Search</div>
        <div class="col-12">KeyWord<span style="color:red">*</span></div>
         <app-autocomplete></app-autocomplete> 
        <div class="col-12 col-md-12"><input type="text" style="width: 100%" id="keyWord"></div>
        <div class="col-12 col-md-6">Distance<span style="color:red">*</span></div>
        <div class="col-12 col-md-6">Category<span style="color:red">*</span></div> 
        <div class="col-md-6" ><input type="text" style="width: 100%" id="distance"></div>
        <div class="col-md-6"> 
            <select name="selectCategory" id="sel" style="width: 100%">
                <option value="default">Default</option>
                <option value="arts&entertainment">Arts & Entertainment</option>
                <option value="health&medical">Health & Medical</option>
                <option value="hotels&travel">Hotels & Travel</option>
                <option value="food">Food</option>
                <option value="professionalService">Professional Services</option>
            </select> 
        </div>
        <div class="col-md-12">Location <span style="color:red">*</span></div>
        <div class="col-md-12"> <input type="text" style="width: 100%" id="location"></div>
        <div class="col-12 col-md-12"><input type = "checkbox" class="checkBox"> Auto-detect my location </div>
        <div class="row">
            <div class="col-6 col-md-6 text-right" (click) = "clickMe()">Submit</div>
            <div class="col-6 col-md-6">Clear</div>
        </div>
    </div>
    <div class="col-md-8 offset-md-2" style="background-color: white; border-radius: 15px; margin-top: 50px;">
        <app-yelp-result [yelpReturnedData]="data"></app-yelp-result>
    </div>
</div> -->


<!-- 2022/11/1 resultTable 第一次修改
    
    <div class="col-md-10 offset-md-1">
    <div class="yelpResult" style="background-color: white; border-radius: 15px; margin-top: 50px; text-align: center;visibility: visible;" id="yelpResult">
             <app-yelp-result [yelpReturnedData]="data"></app-yelp-result> (click) = "onClickRow(yelpResult)" style="cursor:pointer"
        <table class="yelpTable table-striped">
                <thead>
                        <tr>
                            <th class="col-1" style="text-align: center">#</th>
                            <th class="col-4" style="text-align: center">Image</th>
                            <th class="col-4" style="text-align: center">Business Name</th>
                            <th class="col-2" style="text-align: center">Rating</th>
                            <th class="col-1" style="text-align: center">Distance</th>
                        </tr>
                </thead>
                <tbody>
                    <ng-container  *ngFor="let yelpResult of data;let i=index">
                            <tr *ngIf="i<10" >
                                <td class="col-1" style="text-align: center">{{i + 1}}</td>
                                <td class="col-1" style="text-align: center"><img src={{yelpResult.image_url}} alt="" style="width: 25%;"></td>
                                <td class="col-1" style="text-align: center">{{yelpResult.name}}</td>
                                <td class="col-1" style="text-align: center">{{yelpResult.rating}}</td>
                                <td class="col-1" style="text-align: center">{{(yelpResult.distance/1609.34).toFixed(0)}}</td>
                            </tr>
                    </ng-container>
                </tbody>
        </table>
    </div>   
</div>

<div class="resultComponent">
    <app-yelp-result [yelpReturnedData]="data"></app-yelp-result>
</div>   
**************************************************************************
-->


<!-- 2022/11/1 resultTable 第二次修改 
    <div class="row" style="margin-top: 50px;">
    <div class="col-md-8 offset-md-2">
        <table class="yelpTable table-striped"  style="background-color: white; border-radius: 15px; text-align: center;visibility: hidden; text-align: center; width: 100%;" id="yelpTable">
            <thead>
                <tr class="row">
                    <th class="col-md-2 col-xs-2" style="text-align: center">#</th>
                    <th class="col-md-3 col-xs-3" style="text-align: center">Image</th>
                    <th class="col-md-3 col-xs-3" style="text-align: center">Business Name</th>
                    <th class="col-md-2 col-xs-2" style="text-align: center">Rating</th>
                    <th class="col-md-2 col-xs-2" style="text-align: center">Distance</th>
                </tr>
            </thead>
            <tbody>
                <ng-container  *ngFor="let yelpResult of data;let i=index">
                    <tr *ngIf="i<10" class="row">
                        <td class="col-md-2 col-xs-2" style="text-align: center">{{i + 1}}</td>
                        <td class="col-md-3 col-xs-3" style="text-align: center"><img src= "{{yelpResult.image_url}}" alt="" style="width:100%;"></td>
                        <td class="col-md-3 col-xs-3" style="text-align: center">{{yelpResult.name}}</td>
                        <td class="col-md-2 col-xs-2" style="text-align: center">{{yelpResult.rating}}</td>
                        <td class="col-md-2 col-xs-2" style="text-align: center">{{(yelpResult.distance/1609.34).toFixed(0)}}</td>
                    </tr>
                </ng-container>
            </tbody>
        </table>  
    </div>
</div> -->

<!-- 
hihi -->

   
<!-- <form class="form-inline">
  <div class="form-group">
    <div class="input-group">
      <input class="form-control" placeholder="yyyy-mm-dd"
             name="dp" [(ngModel)]="model" ngbDatepicker #d="ngbDatepicker">
      <div class="input-group-append">
        <button class="btn btn-outline-secondary calendar" (click)="d.toggle()" type="button"></button>
      </div>
    </div>
  </div>
</form>
     -->
